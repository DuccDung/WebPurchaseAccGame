@using SystemPurchaseAccGame.ViewModel
@{
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
}
@model List<AccountListingVm>

<main>
    <main class="acc_detail_main">
        <section class="acc_detail_sectionTitle" aria-label="Danh sách account">
            <h1>Danh sách Account</h1>
            <div class="acc_detail_underline" aria-hidden="true"></div>
        </section>

        <!-- SEARCH -->
        <section class="acc_detail_toolbar" aria-label="Tìm kiếm">
            <div class="acc_detail_searchBox">
                <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
                <input id="searchTitle"
                       type="search"
                       placeholder="Tìm theo tiêu đề (title)..." />
            </div>
            <div class="acc_detail_resultHint" id="resultHint">
                Hiển thị: <strong id="countVisible">0</strong> /
                <strong id="countTotal">0</strong>
            </div>
        </section>

        <div class="acc_detail_empty" id="emptyState">
            Không tìm thấy account phù hợp.
        </div>

        <!-- GRID -->
        <section class="acc_detail_accountsGrid"
                 id="accountsGrid"
                 aria-label="Danh sách account">
           
            @foreach (var item in Model)
            {
                <article class="acc_detail_account-card"
                         data-title="đây là nick nhiều sao nhất">
                    <div class="acc_detail_account-card__media">
                        <img src="@item.urlPhoto"
                             alt="Ảnh account"
                             loading="lazy" />
                    </div>

                    <div class="acc_detail_account-card__overlay">
                        <span class="acc_detail_badge">
                            <span class="acc_detail_statusDot" aria-hidden="true"></span> ID:
                            <strong>@item.AccountListingId</strong>
                        </span>
                        <span class="acc_detail_badge">
                            <i class="fa-solid fa-tag" aria-hidden="true"></i>
                            AVAILABLE
                        </span>
                    </div>

                    <div class="acc_detail_account-card__body">
                        <h3 class="acc_detail_account-title">@item.Title</h3>
                        <div class="acc_detail_priceRow">
                            <span class="acc_detail_priceLabel">Giá</span>
                            <div class="acc_detail_priceValue">
                                @item.Price.ToString("N0", new System.Globalization.CultureInfo("vi-VN"))
                                <span class="acc_detail_currency">VNĐ</span>
                            </div>
                        </div>
                        <p class="acc_detail_desc">@item.Description</p>
                    </div>

                    <div class="acc_detail_account-card__actions">
                        <a class="acc_detail_btn" asp-controller="home" asp-action="purchase" asp-route-id="@item.AccountListingId">
                            <i class="fa-solid fa-circle-info" aria-hidden="true"></i> Chi
                            tiết
                        </a>
                        <a class="acc_detail_btn acc_detail_btn--primary" asp-controller="home" asp-action="purchase" asp-route-id="@item.AccountListingId">
                            <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i> Mua
                            ngay
                        </a>
                    </div>
                </article>

            }
        </section>
    </main>

    <script>
        // Theme toggle (light/dark/system)
        (() => {
          const themeRoot = document.documentElement;
          const themeToggle = document.querySelector("[data-theme-toggle]");
          const THEME_KEY = "site-theme";

          function getSystemTheme() {
            return window.matchMedia?.("(prefers-color-scheme: dark)").matches
              ? "dark"
              : "light";
          }
          function applyTheme(theme) {
            themeRoot.dataset.theme = theme;
            const effective = theme === "system" ? getSystemTheme() : theme;
            themeToggle.innerHTML =
              effective === "dark"
                ? '<i class="fa-solid fa-moon" aria-hidden="true"></i>'
                : '<i class="fa-solid fa-sun" aria-hidden="true"></i>';
          }
          const saved = localStorage.getItem(THEME_KEY) || "system";
          applyTheme(saved);

          themeToggle?.addEventListener("click", () => {
            const current = themeRoot.dataset.theme || "system";
            const next =
              current === "system"
                ? "light"
                : current === "light"
                  ? "dark"
                  : "system";
            localStorage.setItem(THEME_KEY, next);
            applyTheme(next);
          });

          const mq = window.matchMedia?.("(prefers-color-scheme: dark)");
          mq?.addEventListener?.("change", () => {
            if ((themeRoot.dataset.theme || "system") === "system")
              applyTheme("system");
          });
        })();

        // ===== Search theo TITLE =====
        (() => {
          const input = document.getElementById("searchTitle");
          const cards = Array.from(
            document.querySelectorAll(".acc_detail_account-card"),
          );
          const empty = document.getElementById("emptyState");
          const countVisible = document.getElementById("countVisible");
          const countTotal = document.getElementById("countTotal");

          function norm(s) {
            return (s || "").toString().trim().toLowerCase();
          }

          function applyFilter() {
            const q = norm(input.value);
            let visible = 0;

            for (const card of cards) {
              const t =
                norm(card.getAttribute("data-title")) ||
                norm(
                  card.querySelector(".acc_detail_account-title")?.textContent,
                );

              const match = q === "" ? true : t.includes(q);
              card.style.display = match ? "" : "none";
              if (match) visible++;
            }

            countVisible.textContent = String(visible);
            empty.dataset.show = visible === 0 ? "true" : "false";
          }

          countTotal.textContent = String(cards.length);
          input.addEventListener("input", applyFilter);
          applyFilter();
        })();
    </script>
</main>

