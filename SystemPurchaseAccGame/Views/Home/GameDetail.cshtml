@model List<SystemPurchaseAccGame.ViewModel.AccountListingVm>
<!doctype html>
<html lang="vi" data-theme="system">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ACC Play Together - Danh sách Account</title>

    <!-- Font Awesome (icons) -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          referrerpolicy="no-referrer" />
   <link href="~/css/home/acc_detail.css" asp-append-version="true" rel="stylesheet" />
</head>

<body>
    <header class="header">
        <nav class="nav" aria-label="Điều hướng chính">
            <div class="nav__container">
                <a class="nav__brand" href="/" aria-label="Trang chủ">
                    <img class="nav__logo" src="~/img/logo.png" alt="Logo" />
                </a>

                <div class="nav__actions">
                    <button class="themeBtn"
                            type="button"
                            aria-label="Đổi giao diện (sáng/tối)"
                            data-theme-toggle
                            title="Đổi giao diện">
                        <i class="fa-solid fa-circle-half-stroke" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="main">
        <section class="sectionTitle" aria-label="Danh sách account">
            <h1>Danh sách Account</h1>
            <div class="underline" aria-hidden="true"></div>
        </section>

        <!-- SEARCH: lọc theo TITLE -->
        <section class="toolbar" aria-label="Tìm kiếm">
            <div class="searchBox">
                <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
                <input id="searchTitle"
                       type="search"
                       placeholder="Tìm theo tiêu đề (title)..." />
            </div>
            <div class="resultHint" id="resultHint">
                Hiển thị: <strong id="countVisible">0</strong> /
                <strong id="countTotal">0</strong>
            </div>
        </section>

        <div class="empty" id="emptyState">Không tìm thấy account phù hợp.</div>

        <!-- GRID -->
        <section class="accountsGrid"
                 id="accountsGrid"
                 aria-label="Danh sách account">
            <!-- ====== DATA DEMO (bạn thay bằng foreach Razor) ====== -->
            @foreach(var item in Model)
            {
                <article class="account-card" data-title="đây là nick nhiều sao nhất">
                    <div class="account-card__media">
                        <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=1400&auto=format&fit=crop"
                             alt="Ảnh account"
                             loading="lazy" />
                    </div>

                    <div class="account-card__overlay">
                        <span class="badge">
                            <span class="statusDot" aria-hidden="true"></span> ID:
                            <strong>2</strong>
                        </span>
                        <span class="badge">
                            <i class="fa-solid fa-tag" aria-hidden="true"></i>
                            AVAILABLE
                        </span>
                    </div>

                    <div class="account-card__body">
                        <h3 class="account-title">Đây là nick nhiều sao nhất</h3>
                        <div class="priceRow">
                            <span class="priceLabel">Giá</span>
                            <div class="priceValue">
                                1,222,222 <span class="currency">VNĐ</span>
                            </div>
                        </div>
                        <p class="desc">NULL</p>
                    </div>

                    <div class="account-card__actions">
                        <a class="btn" href="/account/details?id=2">
                            <i class="fa-solid fa-circle-info" aria-hidden="true"></i> Chi
                            tiết
                        </a>
                        <a class="btn btn--primary" href="/order/buy?id=2">
                            <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i> Mua
                            ngay
                        </a>
                    </div>
                </article>
            }
        </section>

    </main>

    <script>
        // Theme toggle (light/dark/system)
        (() => {
          const themeRoot = document.documentElement;
          const themeToggle = document.querySelector("[data-theme-toggle]");
          const THEME_KEY = "site-theme";

          function getSystemTheme() {
            return window.matchMedia?.("(prefers-color-scheme: dark)").matches
              ? "dark"
              : "light";
          }
          function applyTheme(theme) {
            themeRoot.dataset.theme = theme;
            const effective = theme === "system" ? getSystemTheme() : theme;
            themeToggle.innerHTML =
              effective === "dark"
                ? '<i class="fa-solid fa-moon" aria-hidden="true"></i>'
                : '<i class="fa-solid fa-sun" aria-hidden="true"></i>';
          }
          const saved = localStorage.getItem(THEME_KEY) || "system";
          applyTheme(saved);

          themeToggle?.addEventListener("click", () => {
            const current = themeRoot.dataset.theme || "system";
            const next =
              current === "system"
                ? "light"
                : current === "light"
                  ? "dark"
                  : "system";
            localStorage.setItem(THEME_KEY, next);
            applyTheme(next);
          });

          const mq = window.matchMedia?.("(prefers-color-scheme: dark)");
          mq?.addEventListener?.("change", () => {
            if ((themeRoot.dataset.theme || "system") === "system")
              applyTheme("system");
          });
        })();

        // ===== Search theo TITLE =====
        (() => {
          const input = document.getElementById("searchTitle");
          const cards = Array.from(document.querySelectorAll(".account-card"));
          const empty = document.getElementById("emptyState");
          const countVisible = document.getElementById("countVisible");
          const countTotal = document.getElementById("countTotal");

          function norm(s) {
            return (s || "").toString().trim().toLowerCase();
          }

          function applyFilter() {
            const q = norm(input.value);
            let visible = 0;

            for (const card of cards) {
              // ưu tiên lấy từ data-title (đã lower), nếu không có thì lấy text title
              const t =
                norm(card.getAttribute("data-title")) ||
                norm(card.querySelector(".account-title")?.textContent);

              const match = q === "" ? true : t.includes(q);
              card.style.display = match ? "" : "none";
              if (match) visible++;
            }

            countVisible.textContent = String(visible);
            empty.dataset.show = visible === 0 ? "true" : "false";
          }

          countTotal.textContent = String(cards.length);
          input.addEventListener("input", applyFilter);
          applyFilter();
        })();
    </script>
</body>
</html>
